#!/bin/bash

THEME=retrosmart-x11-cursors
DELAY=90
pngs=()
configs=()
cursors=()

for i in {black,white,black-color,white-color}{/anim,/static}/*/*/*
do
    color=$(echo $i | cut -d/ -f1)
    static=$(echo $i |cut -d/ -f2)
    size=$(echo $i | cut -d/ -f3)
    x=$(echo $i | cut -d/ -f4 | cut -d, -f1)
    y=$(echo $i | cut -d/ -f4 | cut -d, -f2)

    if [ X$static == Xstatic ]
    then
        name=$(basename $i .xpm)

        cursor=$color/$name.cursor
        png=$color/$name$size.png
        config=$color/$name.in

        pngs+=($png)
        configs+=($config)
        cursors+=($cursor)

        echo $png: $i
        echo -e "\tconvert \$^ \$@"

        echo $config: $png
        echo -e "\t@echo $size $x $y $png > \$@"

        echo $cursor: $config
        echo -e "\txcursorgen \$^ \$@"

    elif [ X$static == Xanim ]
    then
        name=$(basename $i)

        cursor=$color/$name.cursor
        config=$color/$name.in

        cursors+=($cursor)
        configs+=($config)

        tpngs=()

        for img in $i/*.xpm
        do

            png=$color/$(basename $img .xpm)$size.png

            pngs+=($png)
            tpngs+=($png)

            echo $png: $img
            echo -e "\tconvert \$^ \$@"
        done

        echo $config: ${tpngs[*]}
        for img in $i/*.xpm
        do
            png=$color/$(basename $img .xpm)$size.png
            echo -e "\t@echo $size $x $y $png $DELAY >> \$@"
        done

        echo $cursor: $config
        echo -e "\txcursorgen \$^ \$@"

    else
        echo FAIL: $static is no static or anim!!! > /dev/stderr
        exit 1
    fi
done > makefile.1

cat <<EOF> makefile.0
default: package
CURSORS=${cursors[*]}
PNGS=${pngs[*]}
CONFIGS=${configs[*]}
cursors: \$(CURSORS)
pngs: \$(PNGS)
configs: \$(CONFIGS)
EOF

cat makefile.0 makefile.in makefile.1 > Makefile

rm makefile.?
